# day17

### 今日已完成的计划

1.学习rcore，第一章# 为内核支持函数调用

### 完成过程

tips：发现这里开始rcore和camp的内容不一样了。。从这往下rcore讲了些riscv abi的东西，camp那边似乎是讲了些别的，我打算都看看，然后试试明天能不能进第二章吧。

1.这一节想好好记录一下。。之前试图记忆rv abi就没记住。。希望这次能记住一些规则！

ra是由**调用者**保存的，但是一般的流程为：jal or jalr保存pc+4（or +2）到ra，然后进入下一个函数后prologue会store ra寄存器到这个子函数的栈帧中。所以你说他是调用者保存我觉得也奇怪，不过也无所谓了。

sp是栈顶指针，fp一般指向栈帧。sp是被调用者保存的原因是在每个函数结尾时需要进行栈帧回收，要不然每次返回之后到父函数在每条j指令后面恢复也太不合理了。。fp同理也是被调用者保存寄存器。

这一节最后的闭包代码比较难理解，unsafe之前也没有用过。与其说是难理解，不如说是不知道这样做的好处在哪里。

---
